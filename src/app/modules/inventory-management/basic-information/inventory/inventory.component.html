<div class="row-flex">
  <div *ngIf="inventoryFormState$ | async" class="card">
    <div class="header">
      <ng-container *ngIf="(inventoryFormState$ | async) === 'create'">
        <h3>انبار جدید</h3>
      </ng-container>
      <ng-container *ngIf="(inventoryFormState$ | async) === 'edit'">
        <div
          *ngIf="
            (inventorySelectedRowsCount$ | async) === 1;
            then thenTemplateName;
            else elseTemplateName
          "
        ></div>

        <ng-template #thenTemplateName> <h3>ویرایش انبار</h3></ng-template>

        <ng-template #elseTemplateName> <h3>ویرایش انبار ها</h3></ng-template>
      </ng-container>
      <img
        alt="X"
        src="./assets/media/icons/duotune/general/gen040.svg"
        (click)="closeForm()"
      />
    </div>
    <form [formGroup]="inventoryCreationForm" (ngSubmit)="onSubmit()" #form>
      <h5>نام انبار</h5>

      <input
        type="text"
        pInputText
        placeholder="مثال: انبار کالاهای اولیه"
        formControlName="inventoryName"
        class="input"
        [pTooltip]="
          (inventorySelectedRowsCount$ | async)! > 1 &&
          (inventoryFormState$ | async) === 'edit'
            ? 'امکان تغییر نام انبارها در ویرایش گروهی وجود ندارد.'
            : ''
        "
        tooltipPosition="left"
        [readOnly]="
          (inventorySelectedRowsCount$ | async)! > 1 &&
          (inventoryFormState$ | async) === 'edit'
        "
        (ngModelChange)="onChange('inventoryName', $event)"
        [ngClass]="{
          'ng-invalid ng-dirty':
            (isSubmitted && inventoryName && inventoryName.errors) ||
            (inventoryName &&
              inventoryName.invalid &&
              (inventoryName.dirty || inventoryName.touched))
        }"
      />
      <ng-container
        *ngIf="
          (isSubmitted && inventoryName && inventoryName.errors) ||
          (inventoryName &&
            inventoryName.invalid &&
            (inventoryName.dirty || inventoryName.touched))
        "
      >
        <app-form-validation-error
          error="نام انبار نمی تواند خالی باشد"
        ></app-form-validation-error>
      </ng-container>
      <h5>دسته بندی</h5>
      <p-dropdown
        [options]="(inventoryCategories$ | async)!"
        optionLabel="name"
        formControlName="categoriesDropdown"
        [placeholder]="
          (isInventoryCategoriesLoading$ | async)
            ? 'در حال دریافت اطلاعات...'
            : 'یک دسته بندی انتخاب کنید'
        "
        [disabled]="(isInventoryCategoriesLoading$ | async) === true"
        (ngModelChange)="onChange('categoriesDropdown', $event)"
        [ngClass]="{
          'ng-invalid ng-dirty':
            (isSubmitted && categoriesDropdown && categoriesDropdown.errors) ||
            (categoriesDropdown &&
              categoriesDropdown.invalid &&
              (categoriesDropdown.dirty || categoriesDropdown.touched))
        }"
        emptyMessage="هیچ دسته بندی یافت نشد"
      ></p-dropdown>

      <ng-container
        *ngIf="
          (isSubmitted && categoriesDropdown && categoriesDropdown.errors) ||
          (categoriesDropdown &&
            categoriesDropdown.invalid &&
            (categoriesDropdown.dirty || categoriesDropdown.touched))
        "
      >
        <app-form-validation-error
          error="لطفا یک دسته بندی انتخاب کنید"
        ></app-form-validation-error>
      </ng-container>
      <h5>فعال</h5>
      <p-inputSwitch
        formControlName="status"
        (ngModelChange)="onChange('status', $event)"
        [ngModel]="true"
      ></p-inputSwitch>
      <h5>دسترسی کاربران</h5>
      <p-multiSelect
        [options]="(inventoryUsers$ | async)!"
        [defaultLabel]="
          (isInventoryUsersLoading$ | async) ? 'در حال دریافت اطلاعات...' : ''
        "
        optionLabel="name"
        display="chip"
        [disabled]="(isInventoryUsersLoading$ | async) === true"
        formControlName="usersDropdown"
        (ngModelChange)="onChange('usersDropdown', $event)"
        [ngClass]="{
          'ng-invalid ng-dirty':
            (isSubmitted && usersDropdown && usersDropdown.errors) ||
            (usersDropdown &&
              usersDropdown.invalid &&
              (usersDropdown.dirty || usersDropdown.touched))
        }"
        emptyMessage="هیچ کاربری یافت نشد"
        emptyFilterMessage="هیچ کاربری یافت نشد"
      ></p-multiSelect>
      <ng-container
        *ngIf="
          (isSubmitted && usersDropdown && usersDropdown.errors) ||
          (usersDropdown &&
            usersDropdown.invalid &&
            (usersDropdown.dirty || usersDropdown.touched))
        "
      >
        <app-form-validation-error
          error="حداقل یک کاربر انتخاب کنید"
        ></app-form-validation-error>
      </ng-container>
      <p-button
        [label]="
          (inventoryFormState$ | async)! === 'create' ? 'ایجاد انبار' : 'ویرایش'
        "
        [loading]="false"
        type="submit"
      ></p-button>
    </form>
  </div>

  <app-grid-style01
    [rowInputData]="rowData$ | async"
    [colInputDefs]="colDefs"
    [pageName]="'inventory'"
    [isInventoryCategoryLoading]="isInventoryCategoriesLoading$ | async"
    [isInventoryUsersLoading]="isInventoryUsersLoading$ | async"
  ></app-grid-style01>
</div>
<p-toast position="top-left"></p-toast>
